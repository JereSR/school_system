{% extends "base.html" %}
{% block content %}

<h2>Solicitudes pendientes</h2>

<table class="table table-dark table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Alumno</th>
            <th>Solicitante</th>
            <th>Motivo</th>
            <th>Datos nuevos</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>

    <tbody>
    {% for s in solicitudes %}
        <tr>
            <td>{{ s.id }}</td>
            <td>{{ s.alumno.nombre }} {{ s.alumno.apellido }}</td>
            <td>{{ s.solicitante.nombre }} {{ s.solicitante.apellido }}</td>
            <td>{{ s.motivo }}</td>

            <!-- Mostrar los datos nuevos formateados -->
            <td>
                <pre style="color: #7cffb2; background: #000; padding:5px;">
{{ s.datos_nuevos_dict | tojson(indent=2) }}
                </pre>
            </td>

            <td>{{ s.estado }}</td>

            <td>
                {% if s.estado == 'pendiente' %}

                    <!-- FORM para APROBAR -->
                    <form method="POST"
                          action="{{ url_for('main.aprobar_solicitud', sol_id=s.id) }}"
                          style="display:inline;">
                        <button type="submit" class="btn btn-success btn-sm">
                            Aprobar
                        </button>
                    </form>

                    <!-- FORM para RECHAZAR -->
                    <form method="POST"
                          action="{{ url_for('main.rechazar_solicitud', sol_id=s.id) }}"
                          style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm">
                            Rechazar
                        </button>
                    </form>

                {% else %}
                    Procesada
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}
